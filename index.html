<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data to Plain Language Clipboard</title>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --background: #ffffff;
        --foreground: #171717;
        --card: #fafafa;
        --card-border: #e5e5e5;
        --muted: #f5f5f5;
        --muted-foreground: #737373;
        --primary: #0066cc;
        --primary-foreground: #ffffff;
        --border: #e5e5e5;
        --destructive: #dc2626;
        --radius: 8px;
        --font-sans:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }

      body {
        font-family: var(--font-sans);
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.6;
        min-height: 100vh;
      }
      .container {
        max-width: 768px;
        margin: 0 auto;
        padding: 48px 16px;
      }
      @media (min-width: 768px) {
        .container {
          padding: 64px 24px;
        }
      }

      header {
        margin-bottom: 48px;
      }
      .header-content {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }
      .icon-wrapper {
        padding: 8px;
        border-radius: var(--radius);
        background-color: rgba(0, 102, 204, 0.1);
      }
      .icon-wrapper svg {
        width: 24px;
        height: 24px;
        color: var(--primary);
      }
      h1 {
        font-size: 24px;
        font-weight: 600;
      }
      .subtitle {
        color: var(--muted-foreground);
        font-size: 14px;
      }
      @media (min-width: 768px) {
        .subtitle {
          font-size: 16px;
        }
      }

      section {
        margin-bottom: 48px;
      }
      .section-title {
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--muted-foreground);
        margin-bottom: 24px;
      }

      .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        margin-bottom: 24px;
      }
      @media (min-width: 768px) {
        .form-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      label {
        font-size: 13px;
        font-weight: 500;
      }
      input {
        height: 48px;
        padding: 0 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 15px;
        font-family: inherit;
        background: var(--background);
        color: var(--foreground);
        transition:
          border-color 0.15s,
          box-shadow 0.15s;
      }
      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
      }
      input::placeholder {
        color: var(--muted-foreground);
      }

      .form-actions {
        display: flex;
        flex-direction: column;
        gap: 12px;
        justify-content: flex-end;
      }
      @media (min-width: 768px) {
        .form-actions {
          flex-direction: row;
        }
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 48px;
        padding: 0 32px;
        border-radius: var(--radius);
        font-size: 15px;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        transition:
          background-color 0.15s,
          opacity 0.15s;
        border: none;
      }
      .btn svg {
        width: 16px;
        height: 16px;
      }
      .btn-primary {
        background-color: var(--primary);
        color: var(--primary-foreground);
      }
      .btn-primary:hover {
        background-color: #0055aa;
      }
      .btn-outline {
        background-color: transparent;
        color: var(--foreground);
        border: 1px solid var(--border);
      }
      .btn-outline:hover {
        background-color: var(--muted);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .btn-full-mobile {
        width: 100%;
      }

      .cite-toggle {
        display: flex;
        gap: 0;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        margin-bottom: 24px;
      }
      .cite-toggle button {
        flex: 1;
        padding: 10px 16px;
        font-size: 13px;
        font-weight: 500;
        font-family: inherit;
        border: none;
        background: var(--background);
        color: var(--muted-foreground);
        cursor: pointer;
        transition:
          background-color 0.15s,
          color 0.15s;
        white-space: nowrap;
      }
      .cite-toggle button:not(:last-child) {
        border-right: 1px solid var(--border);
      }
      .cite-toggle button.active {
        background-color: var(--primary);
        color: var(--primary-foreground);
      }

      .section-actions {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      @media (min-width: 768px) {
        .section-actions {
          flex-direction: row;
        }
      }
      .section-actions .btn {
        flex: 1;
      }
      .form-fields-collapsible {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 0.3s ease, opacity 0.2s ease;
      }
      .form-fields-collapsible.expanded {
        max-height: 500px;
        opacity: 1;
      }
      .section-collapsible {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        visibility: hidden;
        transition: max-height 0.4s ease, opacity 0.25s ease, visibility 0s 0.4s;
      }
      .section-collapsible.expanded {
        max-height: 1000px;
        opacity: 1;
        visibility: visible;
        transition: max-height 0.4s ease, opacity 0.25s ease, visibility 0s 0s;
      }

      .output-card {
        padding: 24px;
        min-height: 200px;
        background-color: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 12px;
      }
      @media (min-width: 768px) {
        .output-card {
          padding: 32px;
        }
      }
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 150px;
        text-align: center;
      }
      .empty-icon {
        padding: 12px;
        border-radius: 50%;
        background-color: var(--muted);
        margin-bottom: 16px;
      }
      .empty-icon svg {
        width: 32px;
        height: 32px;
        color: var(--muted-foreground);
        opacity: 0.5;
      }
      .empty-text {
        color: var(--muted-foreground);
        font-size: 14px;
      }

      .statements-list {
        list-style: disc;
        padding-left: 24px;
        margin-bottom: 24px;
      }
      .statements-list li {
        margin-bottom: 12px;
        line-height: 1.6;
      }
      .statement-content {
        display: inline-flex;
        align-items: flex-start;
        gap: 8px;
      }
      .statement-content sup {
        font-size: 12px;
        color: var(--primary);
        font-weight: 500;
        margin-left: 2px;
      }
      .in-text-cite {
        color: var(--muted-foreground);
        font-size: 14px;
      }
      .remove-btn {
        visibility: hidden;
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        border-radius: 4px;
        transition: visibility 0s;
      }
      .statements-list li:hover .remove-btn {
        visibility: visible;
      }
      .remove-btn:hover {
        background-color: var(--muted);
      }
      .remove-btn svg {
        width: 14px;
        height: 14px;
        color: var(--muted-foreground);
      }
      .remove-btn:hover svg {
        color: var(--destructive);
      }

      .footnotes-section {
        border-top: 1px solid var(--border);
        padding-top: 24px;
        margin-top: 24px;
      }
      .footnotes-title {
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--muted-foreground);
        margin-bottom: 16px;
      }
      .footnotes-list {
        list-style: decimal;
        padding-left: 24px;
      }
      .footnotes-list li {
        font-size: 14px;
        color: var(--muted-foreground);
        margin-bottom: 8px;
        line-height: 1.5;
      }

      .graph-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
        margin-bottom: 24px;
        padding: 16px 0;
      }
      .graph-node {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
      }
      .graph-circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--primary);
        background-color: rgba(0, 102, 204, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 600;
        color: var(--primary);
      }
      .graph-label {
        font-size: 11px;
        color: var(--muted-foreground);
        text-align: center;
        max-width: 120px;
        line-height: 1.3;
        word-wrap: break-word;
      }
      .graph-edge {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        min-width: 80px;
        max-width: 200px;
        position: relative;
      }
      .graph-line {
        width: 100%;
        height: 2px;
        background-color: var(--primary);
        position: relative;
      }
      .graph-line::after {
        content: "";
        position: absolute;
        right: -1px;
        top: -4px;
        border: 5px solid transparent;
        border-left-color: var(--primary);
      }
      .graph-edge-label {
        font-size: 11px;
        color: var(--primary);
        font-weight: 500;
        margin-bottom: 6px;
        text-align: center;
        white-space: nowrap;
      }

      .input-preview-card {
        padding: 24px;
        background-color: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        margin-bottom: 16px;
      }
      @media (min-width: 768px) {
        .input-preview-card {
          padding: 32px;
        }
      }
      .input-preview-empty {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 80px;
        color: var(--muted-foreground);
        font-size: 14px;
      }
      .input-table-wrap {
        -webkit-user-select: none;
        user-select: none;
      }
      .input-table {
        width: 100%;
        border-collapse: collapse;
      }
      .input-table th {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--muted-foreground);
        text-align: left;
        padding: 0 12px 8px 12px;
      }
      .input-table td {
        padding: 10px 12px;
        font-size: 15px;
        border-top: 1px solid var(--border);
      }
      .input-table-source {
        margin-top: 12px;
        font-size: 13px;
        color: var(--muted-foreground);
      }
      .input-table-source strong {
        font-weight: 600;
      }
      .input-graph-preview {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
        padding: 16px 0;
        -webkit-user-select: none;
        user-select: none;
      }

      .button-group {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }
      @media (min-width: 768px) {
        .button-group {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      footer {
        margin-top: 64px;
        padding-top: 32px;
        border-top: 1px solid var(--border);
      }
      footer p {
        font-size: 12px;
        color: var(--muted-foreground);
        text-align: center;
      }

      .toast {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: var(--foreground);
        color: var(--background);
        padding: 12px 20px;
        border-radius: var(--radius);
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(100px);
        opacity: 0;
        transition:
          transform 0.3s,
          opacity 0.3s;
        z-index: 1000;
        max-width: 300px;
      }
      .toast.show {
        transform: translateY(0);
        opacity: 1;
      }
      .toast.error {
        background: var(--destructive);
      }

      .why-panel-toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: var(--radius);
        border: 1px solid var(--primary);
        background: rgba(0, 102, 204, 0.06);
        color: var(--primary);
        font-size: 14px;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        transition: background-color 0.15s;
        margin-bottom: 0;
      }
      .why-panel-toggle:hover {
        background: rgba(0, 102, 204, 0.12);
      }
      .why-panel-toggle svg {
        width: 16px;
        height: 16px;
        transition: transform 0.2s;
      }
      .why-panel-toggle.open svg {
        transform: rotate(90deg);
      }
      .why-panel {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 0.4s ease, opacity 0.3s ease, margin 0.3s ease;
        margin-top: 0;
      }
      .why-panel.open {
        max-height: 3000px;
        opacity: 1;
        margin-top: 16px;
      }
      .why-panel-content {
        padding: 24px;
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 12px;
      }
      .why-panel-content h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--foreground);
      }
      .why-panel-content h4 {
        font-size: 13px;
        font-weight: 600;
        margin-top: 16px;
        margin-bottom: 4px;
        color: var(--foreground);
      }
      .why-panel-content p {
        font-size: 14px;
        line-height: 1.6;
        color: var(--muted-foreground);
        margin-bottom: 8px;
      }
      .why-panel-content .why-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-top: 12px;
      }
      @media (min-width: 768px) {
        .why-panel-content .why-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      .why-card {
        padding: 14px 16px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--background);
      }
      .why-card-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--foreground);
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .why-card-title svg {
        width: 14px;
        height: 14px;
        color: var(--primary);
        flex-shrink: 0;
      }
      .why-card p {
        font-size: 13px;
        margin-bottom: 0;
      }
      .why-divider {
        border: none;
        border-top: 1px solid var(--border);
        margin: 20px 0;
      }
      .why-panel-content .why-bottom {
        font-size: 13px;
        font-style: italic;
        color: var(--muted-foreground);
        margin-bottom: 0;
      }

      .section-hint {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        padding: 10px 14px;
        border-radius: var(--radius);
        background: rgba(0, 102, 204, 0.05);
        border: 1px solid rgba(0, 102, 204, 0.12);
        margin-bottom: 16px;
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        padding: 0 14px;
        margin-bottom: 0;
        border-width: 0;
        transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease, margin 0.3s ease, border-width 0.3s ease;
      }
      .section-hint.visible {
        max-height: 200px;
        opacity: 1;
        padding: 10px 14px;
        margin-bottom: 16px;
        border-width: 1px;
      }
      .section-hint svg {
        width: 14px;
        height: 14px;
        color: var(--primary);
        flex-shrink: 0;
        margin-top: 2px;
      }
      .section-hint p {
        font-size: 13px;
        color: var(--muted-foreground);
        line-height: 1.5;
      }
      .section-hint strong {
        color: var(--foreground);
        font-weight: 500;
      }
      .hint-toggle-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }
      .hint-toggle-btn {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 0;
        border: none;
        background: none;
        color: var(--primary);
        font-size: 12px;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.15s;
      }
      .hint-toggle-btn:hover {
        opacity: 1;
      }
      .hint-toggle-btn svg {
        width: 13px;
        height: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-content">
          <div class="icon-wrapper">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
          </div>
          <h1>Data to Plain Language Clipboard</h1>
        </div>
        <p class="subtitle">
          Turns a table row or graph link into plain language. Collect multiple sets of data without leaving the PAI/CAI tool, then export into common universal formats: import into word processors (with proper footnotes), spreadsheet tables, knowledge graphs, link analysis tools, and the W3C standard for provenance ontology (keeps sourcing when importing into big data).
        </p>
        <div style="margin-top: 16px;">
          <button class="why-panel-toggle" id="whyToggleBtn" data-testid="button-why-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
            </svg>
            Why This Exists
          </button>
          <div class="why-panel" id="whyPanel">
            <div class="why-panel-content">
              <h3>The Problem This Solves</h3>
              <p>PAI and CAI tools surface structured data — names, roles, organizations, accounts, transactions, phone numbers, sources. But there is a gap between the way something is displayed on a user's screen and what's useful to end users. The most common gap: turning CAI into plain-language text with proper attribution.</p>
              <p><strong>That gap is filled every day by humans retyping information they are already looking at on a screen.</strong></p>

              <div class="why-grid">
                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    The Retyping Tax
                  </div>
                  <p>Hundreds of workflows per day, each requiring manual retyping. Every retype is a chance for misspelled names, transposed numbers, and misattributed roles. Quiet errors that propagate downstream.</p>
                </div>

                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    The Screenshot Problem
                  </div>
                  <p>Screenshots turn usable data into pictures. Pictures cannot be searched, copied, parsed, or validated. Anyone downstream has to retype from the image. The error chain starts again.</p>
                </div>

                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
                    Split-Screen Context Switching
                  </div>
                  <p>When the tool does not export well, users split their screen between the tool, a report, a spreadsheet, and email. Every window switch is a chance to paste the wrong value in the wrong place.</p>
                </div>

                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    Footnotes Do Not Survive Copy-Paste
                  </div>
                  <p>HTML footnotes are stripped when copying to Word. Zero chance of preserving citations through the clipboard. Every source has to be manually reconstructed. Every time.</p>
                </div>

                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18M9 4v16M15 4v16"/></svg>
                    Cutting Tables Into Documents
                  </div>
                  <p>Users copy whole tables to get one row. Then delete the extra headers, columns, and formatting. This is work the tool should have done — offer the data as a sentence, not a table to reshape.</p>
                </div>

                <div class="why-card">
                  <div class="why-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                    The Misery Scales With Utility
                  </div>
                  <p>The better the tool, the more it gets used. The more it gets used, the more retyping, screenshots, and reformatting. The most valuable tools create the most export friction.</p>
                </div>
              </div>

              <hr class="why-divider"/>

              <h4>No One Can Predict What the End User Wants</h4>
              <p>The person in the tool is rarely the final consumer. Some downstream readers want sentences. Others want spreadsheets, graphs, footnotes, or no citations at all. One clipboard with multiple export formats lets users pick the right output without reformatting.</p>

              <h4>Why Not Use Generative AI?</h4>
              <p>Putting a variable into a sentence is the second thing someone learns when coding. It is deterministic, instant, free, and cannot hallucinate. Generative AI is expensive, adds latency, and occasionally wrong — for a task that is literally string concatenation.</p>

              <h4>Why This Costs Almost Nothing</h4>
              <p>The sentence assembly runs entirely in the user's browser (front end). No server calls, no API traffic, no database queries. The provider's infrastructure is not involved. It scales to any number of users at near-zero marginal cost.</p>

              <p class="why-bottom">If you are going to let users copy one thing, let them copy many things. That is what turns a convenience feature into a workflow tool.</p>
            </div>
          </div>
        </div>
      </header>

      <section>
        <div class="hint-toggle-row">
          <h2 class="section-title" style="margin-bottom: 0;">Add New Statement</h2>
          <button class="hint-toggle-btn" data-hint="hint-section1" data-testid="button-hint-section1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            What this demonstrates
          </button>
        </div>
        <div class="section-hint" id="hint-section1">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <p><strong>This section simulates data in a CAI system in a table or graph.</strong> The way most data is displayed on screen. "Fill and Display" creates sample data. "Manually Enter" lets you put your own data in.</p>
        </div>
        <form id="entryForm">
          <div class="section-actions">
            <button
              type="button"
              class="btn btn-outline"
              id="randomBtn"
              data-testid="button-random"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 01-1.806-1.741 48.826 48.826 0 010-8.938A2 2 0 016.05 2.79l1.932.386a6 6 0 003.86-.517l.318-.158a6 6 0 013.86-.517l2.387.477a2 2 0 011.022.547M19.428 15.428a48.854 48.854 0 000-10.856M19.428 15.428l.163 1.036a2 2 0 01-1.022 2.107l-.373.186a48.89 48.89 0 01-5.577 2.267"
                />
              </svg>
              Fill and Display
            </button>
            <button
              type="button"
              class="btn btn-outline"
              id="manualEntryBtn"
              data-testid="button-manual-entry"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                />
              </svg>
              Manually Enter
            </button>
          </div>
          <div class="form-fields-collapsible" id="formFieldsCollapsible">
            <div class="form-grid">
              <div class="form-group">
                <label for="subject">Subject</label>
                <input
                  type="text"
                  id="subject"
                  placeholder="e.g., Amara Okafor"
                  required
                  data-testid="input-subject"
                />
              </div>
              <div class="form-group">
                <label for="predicate">Predicate</label>
                <input
                  type="text"
                  id="predicate"
                  placeholder="e.g., is the former CEO of"
                  required
                  data-testid="input-predicate"
                />
              </div>
              <div class="form-group">
                <label for="object">Object</label>
                <input
                  type="text"
                  id="object"
                  placeholder="e.g., Helios Dynamics"
                  required
                  data-testid="input-object"
                />
              </div>
              <div class="form-group">
                <label for="source">Source</label>
                <input
                  type="text"
                  id="source"
                  placeholder="e.g., Bloomberg, Jan 2025"
                  required
                  data-testid="input-source"
                />
              </div>
            </div>
          </div>
        </form>
      </section>

      <section>
        <div class="hint-toggle-row">
          <h2 class="section-title" style="margin-bottom: 0;">Existing Display</h2>
          <button class="hint-toggle-btn" data-hint="hint-section2" data-testid="button-hint-section2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            What this demonstrates
          </button>
        </div>
        <div class="section-hint" id="hint-section2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <p><strong>Same data, two views.</strong> The table shows compact relationship codes (CTO, INVESTOR) for scanning. The graph shows the same data as connected nodes. Both use relationship codes for clarity. Toggle between them to see how one structured entry supports both tabular and graph representations — no additional processing.</p>
        </div>
        <div id="existingDisplayCollapsible">
          <div class="cite-toggle" id="inputPreviewToggle" data-testid="toggle-input-preview">
            <button class="active" data-mode="table" data-testid="button-input-table">
              Table
            </button>
            <button data-mode="graph" data-testid="button-input-graph">
              Graph
            </button>
          </div>
          <div class="input-preview-card" id="inputPreviewCard">
            <div class="input-preview-empty" id="inputPreviewEmpty">
              Use Random Fill or Manually Enter to add data.
            </div>
            <div id="inputTableView" style="display: none">
              <div class="input-table-wrap" oncontextmenu="return false" data-testid="input-table-wrap">
                <table class="input-table" data-testid="input-table">
                  <thead>
                    <tr>
                      <th>Subject</th>
                      <th>Relationship</th>
                      <th>Object</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td id="previewSubjectCell"></td>
                      <td id="previewPredicateCell"></td>
                      <td id="previewObjectCell"></td>
                    </tr>
                  </tbody>
                </table>
                <div class="input-table-source" id="previewSourceRow"></div>
              </div>
            </div>
            <div id="inputGraphView" style="display: none">
              <div class="input-graph-preview" id="inputGraphArea" data-testid="input-graph-area"></div>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-primary"
            id="addToClipboardBtn"
            style="width: 100%"
            data-testid="button-add-clipboard"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 4v16m8-8H4"
              />
            </svg>
            Add to Clipboard
          </button>
        </div>
      </section>

      <section>
        <div class="hint-toggle-row">
          <h2 class="section-title" style="margin-bottom: 0;">Output Preview</h2>
          <button class="hint-toggle-btn" data-hint="hint-section3" data-testid="button-hint-section3">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            What this demonstrates
          </button>
        </div>
        <div class="section-hint" id="hint-section3">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          <p><strong>One clipboard, five export formats.</strong> Statements accumulate here using full predicate text — readable sentences, not codes. Toggle between citation modes (footnote, in-text, none, graph). Export as plain text copy, RTF with real Word footnotes, flat CSV, graph-ready node/edge CSV, or W3C PROV-O JSON-LD. The user never reformats — they pick the right output for their audience.</p>
        </div>
        <div class="cite-toggle" id="citeToggle" data-testid="toggle-citation">
          <button
            class="active"
            data-mode="none"
            data-testid="button-cite-none"
          >
            No Cite
          </button>
          <button data-mode="inline" data-testid="button-cite-inline">
            In-Text Cite
          </button>
          <button data-mode="footnote" data-testid="button-cite-footnote">
            Footnote Cite
          </button>
          <button data-mode="graph" data-testid="button-cite-graph">
            Graph
          </button>
        </div>
        <div class="output-card" id="outputCard">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
            </div>
            <p class="empty-text">
              No statements yet. Add your first statement above.
            </p>
          </div>
          <div id="contentArea" style="display: none">
            <div id="statementsArea">
              <ul class="statements-list" id="statementsList"></ul>
              <div class="footnotes-section" id="footnotesSection">
                <h3 class="footnotes-title">Footnotes</h3>
                <ol class="footnotes-list" id="footnotesList"></ol>
              </div>
            </div>
            <div id="graphViewArea" style="display: none">
              <div id="graphArea"></div>
            </div>
          </div>
        </div>
      </section>

      <div class="button-group">
        <button
          class="btn btn-outline btn-full-mobile"
          id="copyBtn"
          disabled
          data-testid="button-copy"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
            />
          </svg>
          Copy as Plain Text
        </button>
        <button
          class="btn btn-primary btn-full-mobile"
          id="downloadBtn"
          disabled
          data-testid="button-download"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
            />
          </svg>
          Download RTF (MS Word)
        </button>
        <button
          class="btn btn-outline btn-full-mobile"
          id="csvSingleBtn"
          disabled
          data-testid="button-csv-single"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 10h18M3 14h18M9 4v16M15 4v16"
            />
          </svg>
          CSV (Single Table)
        </button>
        <button
          class="btn btn-outline btn-full-mobile"
          id="csvNodeEdgeBtn"
          disabled
          data-testid="button-csv-nodeedge"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485"
            />
          </svg>
          CSV (Node/Edge)
        </button>
        <button
          class="btn btn-outline btn-full-mobile"
          id="provBtn"
          disabled
          data-testid="button-prov"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
            />
          </svg>
          PROV-O JSON-LD
        </button>
      </div>

      <footer>
        <p>
          Tip: RTF opens in Microsoft Word with proper footnotes. PROV-O
          JSON-LD follows the W3C provenance standard for linked data.
        </p>
      </footer>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      let entries = [];
      let citeMode = "none";
      let inputPreviewMode = "table";
      let manualExpanded = false;

      var whyToggleBtn = document.getElementById("whyToggleBtn");
      var whyPanel = document.getElementById("whyPanel");
      whyToggleBtn.addEventListener("click", function () {
        var isOpen = whyPanel.classList.toggle("open");
        whyToggleBtn.classList.toggle("open", isOpen);
      });

      document.querySelectorAll(".hint-toggle-btn").forEach(function (btn) {
        btn.addEventListener("click", function () {
          var hintId = btn.getAttribute("data-hint");
          var hint = document.getElementById(hintId);
          if (hint) {
            hint.classList.toggle("visible");
          }
        });
      });

      const form = document.getElementById("entryForm");
      const emptyState = document.getElementById("emptyState");
      const contentArea = document.getElementById("contentArea");
      const statementsArea = document.getElementById("statementsArea");
      const graphViewArea = document.getElementById("graphViewArea");
      const statementsList = document.getElementById("statementsList");
      const footnotesList = document.getElementById("footnotesList");
      const footnotesSection = document.getElementById("footnotesSection");
      const graphArea = document.getElementById("graphArea");
      const copyBtn = document.getElementById("copyBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const csvSingleBtn = document.getElementById("csvSingleBtn");
      const csvNodeEdgeBtn = document.getElementById("csvNodeEdgeBtn");
      const provBtn = document.getElementById("provBtn");
      const randomBtn = document.getElementById("randomBtn");
      const manualEntryBtn = document.getElementById("manualEntryBtn");
      const addToClipboardBtn = document.getElementById("addToClipboardBtn");
      const formFieldsCollapsible = document.getElementById("formFieldsCollapsible");
      const existingDisplayCollapsible = document.getElementById("existingDisplayCollapsible");
      const citeToggle = document.getElementById("citeToggle");
      const toastEl = document.getElementById("toast");

      const inputPreviewToggle = document.getElementById("inputPreviewToggle");
      const inputPreviewEmpty = document.getElementById("inputPreviewEmpty");
      const inputTableView = document.getElementById("inputTableView");
      const inputGraphView = document.getElementById("inputGraphView");
      const inputGraphArea = document.getElementById("inputGraphArea");
      const previewSubjectCell = document.getElementById("previewSubjectCell");
      const previewPredicateCell = document.getElementById("previewPredicateCell");
      const previewObjectCell = document.getElementById("previewObjectCell");
      const previewSourceRow = document.getElementById("previewSourceRow");
      const subjectInput = document.getElementById("subject");
      const predicateInput = document.getElementById("predicate");
      const objectInput = document.getElementById("object");
      const sourceInput = document.getElementById("source");

      const subjects = [
        "Amara Okafor",
        "James Whitfield",
        "Mei-Lin Chen",
        "Carlos Gutierrez",
        "Priya Sharma",
        "Fatima Al-Rashid",
        "Kenji Tanaka",
        "Sarah Lindstr\u00f6m",
        "Dmitri Volkov",
        "Aisha Johnson",
      ];
      const relationships = [
        { code: "FORMER_CEO", predicate: "is the former CEO of" },
        { code: "BOARDMEMBER", predicate: "is on the board of" },
        { code: "FOUNDER", predicate: "founded" },
        { code: "LEAD_COUNSEL", predicate: "is the lead counsel for" },
        { code: "CTO", predicate: "is the chief technology officer of" },
        { code: "INVESTOR", predicate: "is a major investor in" },
        { code: "CHAIRPERSON", predicate: "serves as chair of" },
        { code: "MANAGING_DIRECTOR", predicate: "is the managing director of" },
        { code: "ADVISOR", predicate: "advises" },
        { code: "NEW_LEADER", predicate: "was recently appointed to lead" },
      ];
      const predicateToCode = {};
      relationships.forEach(function (r) {
        predicateToCode[r.predicate] = r.code;
      });
      const objects = [
        "Helios Dynamics",
        "Vantage Bioworks",
        "Crescent & Vale",
        "NovaTerre Systems",
        "Pinecrest Analytics",
        "Ironlake Capital",
        "Sable Meridian Group",
        "Axiom Cybernetics",
        "Windrow Logistics",
        "Coralstone Energy",
      ];
      const sources = [
        "Bloomberg, Jan 2025",
        "Financial Times, Mar 2024",
        "Reuters Corporate Filing, 2024",
        "SEC Form 8-K, Feb 2025",
        "Wall Street Journal, Nov 2024",
        "Forbes Global 500, 2024",
        "TechCrunch, Aug 2024",
        "Harvard Business Review, 2024",
        "The Economist, Dec 2024",
        "Annual Report, FY2024",
      ];

      function pickRandom(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function escapeRtf(text) {
        return text
          .replace(/\\/g, "\\\\")
          .replace(/\{/g, "\\{")
          .replace(/\}/g, "\\}");
      }

      function showToast(message, isError) {
        toastEl.textContent = message;
        toastEl.className = "toast show" + (isError ? " error" : "");
        setTimeout(function () {
          toastEl.className = "toast";
        }, 3000);
      }

      citeToggle.addEventListener("click", function (e) {
        var btn = e.target.closest("button");
        if (!btn) return;
        citeMode = btn.getAttribute("data-mode");
        citeToggle.querySelectorAll("button").forEach(function (b) {
          b.classList.remove("active");
        });
        btn.classList.add("active");
        renderOutput();
      });

      manualEntryBtn.addEventListener("click", function () {
        manualExpanded = !manualExpanded;
        if (manualExpanded) {
          formFieldsCollapsible.classList.add("expanded");
        } else {
          formFieldsCollapsible.classList.remove("expanded");
        }
      });

      inputPreviewToggle.addEventListener("click", function (e) {
        var btn = e.target.closest("button");
        if (!btn) return;
        inputPreviewMode = btn.getAttribute("data-mode");
        inputPreviewToggle.querySelectorAll("button").forEach(function (b) {
          b.classList.remove("active");
        });
        btn.classList.add("active");
        renderInputPreview();
      });

      function renderInputPreview() {
        var s = subjectInput.value.trim();
        var p = predicateInput.value.trim();
        var o = objectInput.value.trim();
        var src = sourceInput.value.trim();
        var hasContent = s || p || o || src;

        if (!hasContent) {
          inputPreviewEmpty.style.display = "flex";
          inputTableView.style.display = "none";
          inputGraphView.style.display = "none";
          return;
        }

        inputPreviewEmpty.style.display = "none";

        if (inputPreviewMode === "table") {
          inputTableView.style.display = "block";
          inputGraphView.style.display = "none";

          previewSubjectCell.textContent = s || "\u2014";
          previewPredicateCell.textContent = (p && predicateToCode[p]) ? predicateToCode[p] : (p || "\u2014");
          previewObjectCell.textContent = o || "\u2014";

          previewSourceRow.innerHTML = "";
          var strong = document.createElement("strong");
          strong.textContent = "Source: ";
          previewSourceRow.appendChild(strong);
          previewSourceRow.appendChild(document.createTextNode(src || "\u2014"));
        } else {
          inputTableView.style.display = "none";
          inputGraphView.style.display = "block";

          inputGraphArea.innerHTML = "";

          var leftNode = document.createElement("div");
          leftNode.className = "graph-node";
          var leftCircle = document.createElement("div");
          leftCircle.className = "graph-circle";
          leftCircle.textContent = "S";
          var leftLabel = document.createElement("div");
          leftLabel.className = "graph-label";
          leftLabel.textContent = s || "\u2014";
          leftNode.appendChild(leftCircle);
          leftNode.appendChild(leftLabel);

          var edge = document.createElement("div");
          edge.className = "graph-edge";
          var edgeLabel = document.createElement("div");
          edgeLabel.className = "graph-edge-label";
          edgeLabel.textContent = (p && predicateToCode[p]) ? predicateToCode[p] : (p || "\u2014");
          var line = document.createElement("div");
          line.className = "graph-line";
          edge.appendChild(edgeLabel);
          edge.appendChild(line);

          var rightNode = document.createElement("div");
          rightNode.className = "graph-node";
          var rightCircle = document.createElement("div");
          rightCircle.className = "graph-circle";
          rightCircle.textContent = "O";
          var rightLabel = document.createElement("div");
          rightLabel.className = "graph-label";
          rightLabel.textContent = o || "\u2014";
          rightNode.appendChild(rightCircle);
          rightNode.appendChild(rightLabel);

          inputGraphArea.appendChild(leftNode);
          inputGraphArea.appendChild(edge);
          inputGraphArea.appendChild(rightNode);
        }
      }

      [subjectInput, predicateInput, objectInput, sourceInput].forEach(function (el) {
        el.addEventListener("input", renderInputPreview);
      });

      function renderOutput() {
        if (entries.length === 0) {
          emptyState.style.display = "flex";
          contentArea.style.display = "none";
          copyBtn.disabled = true;
          downloadBtn.disabled = true;
          csvSingleBtn.disabled = true;
          csvNodeEdgeBtn.disabled = true;
          provBtn.disabled = true;
          return;
        }

        emptyState.style.display = "none";
        contentArea.style.display = "block";
        copyBtn.disabled = citeMode === "graph";
        downloadBtn.disabled = citeMode === "graph";
        csvSingleBtn.disabled = false;
        csvNodeEdgeBtn.disabled = false;
        provBtn.disabled = false;

        if (citeMode === "graph") {
          statementsArea.style.display = "none";
          graphViewArea.style.display = "block";
        } else {
          statementsArea.style.display = "block";
          graphViewArea.style.display = "none";
        }

        statementsList.innerHTML = "";
        entries.forEach(function (entry, index) {
          var li = document.createElement("li");
          var span = document.createElement("span");
          span.className = "statement-content";

          var textSpan = document.createElement("span");
          textSpan.textContent =
            entry.subject + " " + entry.predicate + " " + entry.object;

          if (citeMode === "footnote") {
            var sup = document.createElement("sup");
            sup.textContent = index + 1;
            textSpan.appendChild(sup);
          } else if (citeMode === "inline") {
            var cite = document.createElement("span");
            cite.className = "in-text-cite";
            cite.textContent = " (" + entry.source + ")";
            textSpan.appendChild(cite);
          }

          var removeBtn = document.createElement("button");
          removeBtn.className = "remove-btn";
          removeBtn.setAttribute("aria-label", "Remove statement");
          removeBtn.setAttribute("data-testid", "button-remove-" + index);
          removeBtn.innerHTML =
            '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>';
          removeBtn.addEventListener("click", function () {
            removeEntry(index);
          });

          span.appendChild(textSpan);
          span.appendChild(removeBtn);
          li.appendChild(span);
          statementsList.appendChild(li);
        });

        if (citeMode === "footnote") {
          footnotesSection.style.display = "block";
          footnotesList.innerHTML = "";
          entries.forEach(function (entry) {
            var li = document.createElement("li");
            li.textContent = entry.source;
            footnotesList.appendChild(li);
          });
        } else {
          footnotesSection.style.display = "none";
        }

        graphArea.innerHTML = "";
        entries.forEach(function (entry, index) {
          var row = document.createElement("div");
          row.className = "graph-row";
          row.setAttribute("data-testid", "graph-row-" + index);

          var leftNode = document.createElement("div");
          leftNode.className = "graph-node";
          var leftCircle = document.createElement("div");
          leftCircle.className = "graph-circle";
          leftCircle.textContent = "S";
          var leftLabel = document.createElement("div");
          leftLabel.className = "graph-label";
          leftLabel.textContent = entry.subject;
          leftNode.appendChild(leftCircle);
          leftNode.appendChild(leftLabel);

          var edge = document.createElement("div");
          edge.className = "graph-edge";
          var edgeLabel = document.createElement("div");
          edgeLabel.className = "graph-edge-label";
          edgeLabel.textContent = predicateToCode[entry.predicate] || entry.predicate;
          var line = document.createElement("div");
          line.className = "graph-line";
          edge.appendChild(edgeLabel);
          edge.appendChild(line);

          var rightNode = document.createElement("div");
          rightNode.className = "graph-node";
          var rightCircle = document.createElement("div");
          rightCircle.className = "graph-circle";
          rightCircle.textContent = "O";
          var rightLabel = document.createElement("div");
          rightLabel.className = "graph-label";
          rightLabel.textContent = entry.object;
          rightNode.appendChild(rightCircle);
          rightNode.appendChild(rightLabel);

          row.appendChild(leftNode);
          row.appendChild(edge);
          row.appendChild(rightNode);
          graphArea.appendChild(row);
        });
      }

      function removeEntry(index) {
        entries.splice(index, 1);
        renderOutput();
        showToast("Entry removed");
      }

      randomBtn.addEventListener("click", function () {
        var rel = pickRandom(relationships);
        subjectInput.value = pickRandom(subjects);
        predicateInput.value = rel.predicate;
        objectInput.value = pickRandom(objects);
        sourceInput.value = pickRandom(sources);
        renderInputPreview();
      });

      addToClipboardBtn.addEventListener("click", function () {
        var subject = subjectInput.value.trim();
        var predicate = predicateInput.value.trim();
        var object = objectInput.value.trim();
        var source = sourceInput.value.trim();

        if (!subject || !predicate || !object || !source) {
          if (!manualExpanded) {
            manualExpanded = true;
            formFieldsCollapsible.classList.add("expanded");
          }
          showToast("Please fill all fields", true);
          return;
        }

        entries.push({
          subject: subject,
          predicate: predicate,
          object: object,
          source: source,
        });
        form.reset();
        renderInputPreview();
        renderOutput();
        showToast("Entry added");
      });

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        addToClipboardBtn.click();
      });

      function generateRTF() {
        var rtfContent = "{\\rtf1\\ansi\\ansicpg1252\\deff0\n";
        rtfContent += "{\\fonttbl{\\f0\\fnil\\fcharset0 Arial;}}\n";
        rtfContent += "\\pard\\f0\\fs22\n";

        entries.forEach(function (entry) {
          var statement =
            escapeRtf(entry.subject) +
            " " +
            escapeRtf(entry.predicate) +
            " " +
            escapeRtf(entry.object);
          var safeSource = escapeRtf(entry.source);
          rtfContent +=
            "{\\pntext\\f0 \\bullet\\tab}{\\*\\pn\\pnlvlblt\\pnf0\\pnindent0{\\pntxtb \\bullet}}\\fi-360\\li720\n";

          if (citeMode === "footnote") {
            rtfContent +=
              statement +
              "{\\super\\chftn}{\\footnote\\pard\\plain\\fs20 {\\super\\chftn} " +
              safeSource +
              "\\par}\\par\n";
          } else if (citeMode === "inline") {
            rtfContent += statement + " (" + safeSource + ")\\par\n";
          } else {
            rtfContent += statement + "\\par\n";
          }
        });

        rtfContent += "}";
        return rtfContent;
      }

      downloadBtn.addEventListener("click", function () {
        if (entries.length === 0) {
          showToast("No content to download", true);
          return;
        }
        downloadFile(
          generateRTF(),
          "statements-with-footnotes.rtf",
          "application/rtf",
        );
        showToast("RTF file downloaded");
      });

      function escapeCsv(value) {
        var str = String(value);
        if (
          str.indexOf('"') !== -1 ||
          str.indexOf(",") !== -1 ||
          str.indexOf("\n") !== -1
        ) {
          return '"' + str.replace(/"/g, '""') + '"';
        }
        return str;
      }

      function downloadFile(content, filename, mimeType) {
        var blob = new Blob([content], { type: mimeType });
        var url = URL.createObjectURL(blob);
        var link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      csvSingleBtn.addEventListener("click", function () {
        if (entries.length === 0) {
          showToast("No content to export", true);
          return;
        }
        var rows = ["Subject,Relationship,Object,Source"];
        entries.forEach(function (e) {
          rows.push(
            escapeCsv(e.subject) +
              "," +
              escapeCsv(e.predicate) +
              "," +
              escapeCsv(e.object) +
              "," +
              escapeCsv(e.source),
          );
        });
        downloadFile(
          rows.join("\n"),
          "statements-single-table.csv",
          "text/csv",
        );
        showToast("CSV (Single Table) downloaded");
      });

      csvNodeEdgeBtn.addEventListener("click", function () {
        if (entries.length === 0) {
          showToast("No content to export", true);
          return;
        }
        var nodeMap = {};
        var nodeId = 1;
        entries.forEach(function (e) {
          if (!nodeMap[e.subject]) {
            nodeMap[e.subject] = nodeId++;
          }
          if (!nodeMap[e.object]) {
            nodeMap[e.object] = nodeId++;
          }
        });

        var lines = ["--- Nodes ---"];
        lines.push("NodeID,Label");
        Object.keys(nodeMap).forEach(function (label) {
          lines.push(nodeMap[label] + "," + escapeCsv(label));
        });

        lines.push("");
        lines.push("--- Edges ---");
        lines.push("SourceNodeID,TargetNodeID,Relationship");
        entries.forEach(function (e) {
          lines.push(
            nodeMap[e.subject] +
              "," +
              nodeMap[e.object] +
              "," +
              escapeCsv(e.predicate),
          );
        });

        downloadFile(lines.join("\n"), "statements-node-edge.csv", "text/csv");
        showToast("CSV (Node/Edge) downloaded");
      });

      copyBtn.addEventListener("click", function () {
        if (entries.length === 0) {
          showToast("No content to copy", true);
          return;
        }

        var plainText;
        if (citeMode === "footnote") {
          plainText =
            entries
              .map(function (e, i) {
                return (
                  "\u2022 " +
                  e.subject +
                  " " +
                  e.predicate +
                  " " +
                  e.object +
                  " [" +
                  (i + 1) +
                  "]"
                );
              })
              .join("\n") +
            "\n\n" +
            entries
              .map(function (e, i) {
                return i + 1 + ". " + e.source;
              })
              .join("\n");
        } else if (citeMode === "inline") {
          plainText = entries
            .map(function (e) {
              return (
                "\u2022 " +
                e.subject +
                " " +
                e.predicate +
                " " +
                e.object +
                " (" +
                e.source +
                ")"
              );
            })
            .join("\n");
        } else {
          plainText = entries
            .map(function (e) {
              return "\u2022 " + e.subject + " " + e.predicate + " " + e.object;
            })
            .join("\n");
        }

        navigator.clipboard
          .writeText(plainText)
          .then(function () {
            showToast("Copied to clipboard");
          })
          .catch(function () {
            showToast("Copy failed. Please try again.", true);
          });
      });

      provBtn.addEventListener("click", function () {
        if (entries.length === 0) {
          showToast("No content to export", true);
          return;
        }

        var provDoc = {
          "@context": {
            prov: "http://www.w3.org/ns/prov#",
            rdfs: "http://www.w3.org/2000/01/rdf-schema#",
            xsd: "http://www.w3.org/2001/XMLSchema#",
          },
          "@graph": entries.map(function (e, i) {
            var statementId = "_:statement" + (i + 1);
            var sourceId = "_:source" + (i + 1);
            return {
              "@id": statementId,
              "@type": "prov:Entity",
              "rdfs:label":
                e.subject + " " + e.predicate + " " + e.object,
              "prov:wasDerivedFrom": {
                "@id": sourceId,
                "@type": "prov:Entity",
                "rdfs:label": e.source,
              },
            };
          }),
        };

        var json = JSON.stringify(provDoc, null, 2);
        downloadFile(json, "statements.jsonld", "application/ld+json");
        showToast("PROV-O JSON-LD downloaded");
      });
    </script>
  </body>
</html>
